import{E as U,e as F,f as B,g as M,h as O}from"./element-plus-b263d37b.js";import{_ as W}from"./error-8ffa6f40.js";import{_ as X}from"./markdownEditor-944df510.js";import{d as I}from"./dayjs-ddc12617.js";import{h as C,u as G,a as J}from"./index-ba33d66b.js";import{r as g,F as N,o as d,c as u,a,W as b,b as i,V as $,u as e,X as z,R as w,bw as H,ai as K,P as q,ae as S,S as Q,_ as Y,a8 as Z,B as ee}from"./@vue-2b4cd1a6.js";import{a as te,b as oe,c as ne}from"./@icon-park-0de560ca.js";import{c as se,a as le}from"./yup-0079fcd3.js";import{u as ae}from"./useSoft-5415d87a.js";import{u as ie}from"./vue-router-f57cd58c.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";import"./@vueuse-b062602b.js";import"./lodash-es-b0faf9a4.js";import"./async-validator-dee29e8b.js";import"./@element-plus-c5e9c587.js";import"./normalize-wheel-es-4ed993c7.js";import"./@sxzz-c75af06c.js";import"./@ctrl-384ef2e5.js";import"./@kangc-c2a2341a.js";import"./vue-68db48eb.js";import"./useUpload-9210c0cb.js";import"./pinia-aad22ebe.js";import"./vue-demi-71ba0ef2.js";/* empty css                    */import"./axios-aba6f0e0.js";import"./prismjs-b3e294df.js";import"./highlight.js-42a3adc5.js";import"./vee-validate-60af52d7.js";import"./@vee-validate-1fd1bc20.js";import"./property-expr-38205fa5.js";import"./tiny-case-d0726479.js";import"./toposort-59d3f8f4.js";const L=t=>{const n=g([]),l=g({});return{findAll:async()=>{n.value=await C.request({url:`comment/${t}`})},add:async s=>{var m;const o=await C.request({url:`comment/${t}`,method:"POST",data:s});l.value.content="",s.commentId?(m=n.value.find(f=>f.id===s.commentId))==null||m.replys.push(o):n.value.push(o)},del:async s=>{await U.confirm("确定要删除吗？"),await C.request({url:`comment/${t}/${s}`,method:"DELETE"});const o=n.value.findIndex(m=>m.id===s);n.value.splice(o,1)},collections:n,model:l}},me={class:"mb-3 border p-3 rounded-md bg-white opacity-90"},re={class:"flex justify-between items-baseline border-b p-3"},de={class:"flex gap-2"},_e=["src"],ue={class:"flex flex-col"},pe={class:"font-bold"},fe={class:"flex items-center text-sm gap-2"},ve={class:"flex items-center text-gray-500"},he={key:0,class:"flex cursor-pointer hover:text-red-500"},ye={class:"p-3"},xe={key:0,class:"p-3"},be=N({__name:"commentItem",props:{comment:null},setup(t,{emit:n}){const{comment:l}=t,{model:r}=L(l.softId);r.value.commentId=l.commentId||l.id;const c=g(!1),{authorize:y}=G();return(s,o)=>{const m=te,f=oe,v=ne,h=F,p=B;return d(),u("section",me,[a("div",re,[a("div",de,[a("img",{src:t.comment.user.avatar,alt:"",class:"w-8 h-8 rounded-full"},null,8,_e),a("div",ue,[a("div",pe,b(t.comment.user.nickname)+" #"+b(t.comment.id),1),a("div",fe,[a("div",ve,[i(m,{theme:"outline",size:"12"}),$(" "+b(e(I)(t.comment.createdAt).fromNow()),1)]),a("div",{class:"flex items-center cursor-pointer hover:font-bold",onClick:o[0]||(o[0]=_=>c.value=!e(c))},[i(f,{theme:"outline",size:"12",fill:"#333"}),$("回复 ")])])])]),e(y)(t.comment.id)?(d(),u("div",he,[i(v,{theme:"outline",size:"14",onClick:o[1]||(o[1]=_=>s.$emit("del",t.comment.id))})])):z("",!0)]),a("div",ye,b(t.comment.content),1),e(c)?(d(),u("div",xe,[i(h,{modelValue:e(r).content,"onUpdate:modelValue":o[2]||(o[2]=_=>e(r).content=_),type:"textarea",placeholder:"",clearable:""},null,8,["modelValue"]),i(p,{type:"primary",size:"small",onClick:o[3]||(o[3]=_=>s.$emit("add",e(r)))},{default:w(()=>[$("提交")]),_:1})])):z("",!0)])}}}),k="interval_exec_time",E=J();let A=0;const D=g(0),we=(t,n)=>{const l=()=>{A=setInterval(()=>{D.value=I(E.get(k)).add(t,"second").diff(I(),"second"),D.value<=0&&(clearInterval(A),A=void 0)},50)},r=async(...c)=>{E.get(k)||(await n.apply(null,c),E.set(k,I(),t),l())};return E.get(k)&&l(),{time:D,exec:r}},$e={class:""},ge={key:0},ke={class:"ml-5"},Ee={class:"py-3"},Ie=N({__name:"commentList",props:{sid:null},async setup(t){let n,l;const{sid:r}=t,{collections:c,findAll:y,model:s,add:o,del:m}=L(r);[n,l]=H(()=>y()),await n,l(),se({content:le().required("内容不能为空").max(1e3,"内容不能超过1000字")});const{exec:f,time:v}=we(20,h=>o(h));return(h,p)=>{const _=be,V=X,R=W,j=B,P=K("clearError");return d(),u("main",$e,[e(c).length?(d(),u("section",ge,[(d(!0),u(q,null,S(e(c),x=>(d(),u("div",{key:x.id},[i(_,{comment:x,onDel:e(m),onAdd:e(o)},null,8,["comment","onDel","onAdd"]),a("div",ke,[(d(!0),u(q,null,S(x.replys,T=>(d(),Q(_,{comment:T,key:T.id,onDel:e(m),onAdd:e(o)},null,8,["comment","onDel","onAdd"]))),128))])]))),128))])):z("",!0),a("section",Ee,[Y(i(V,{modelValue:e(s).content,"onUpdate:modelValue":p[0]||(p[0]=x=>e(s).content=x)},null,8,["modelValue"]),[[P,"content"]]),i(R,{name:"content"}),i(j,{type:"primary",disabled:e(v)>0,size:"default",class:"mt-3",onClick:p[1]||(p[1]=x=>e(f)(e(s)))},{default:w(()=>[$("保存提交"+b(e(v)>0?`(${e(v)})`:""),1)]),_:1},8,["disabled"])])])}}}),Ve={class:""},Ce={class:"bg-white p-5 rounded-md"},Ae={class:"text-xl font-bold flex justify-between opacity-90"},De={class:""},ze={class:""},Be=N({__name:"show",async setup(t){let n,l;const{find:r,model:c}=ae(),y=ie();c.value=([n,l]=H(()=>r(+y.params.id)),n=await n,l(),n);const s=g("comment");return(o,m)=>{const f=B,v=Z("v-md-preview"),h=M,p=Ie,_=O;return d(),u("main",Ve,[a("section",Ce,[a("h1",Ae,[$(b(e(c).title)+" ",1),a("div",De,[i(f,{type:"primary",size:"default",onClick:m[0]||(m[0]=()=>{})},{default:w(()=>[$("下载软件")]),_:1})])])]),i(_,{modelValue:e(s),"onUpdate:modelValue":m[1]||(m[1]=V=>ee(s)?s.value=V:null),type:"card","tab-position":"top",class:"bg-white mt-5 rounded-sm opacity-90 px-5 mt-5 pt-5"},{default:w(()=>[i(h,{label:"软件介绍",name:"content"},{default:w(()=>[a("section",ze,[i(v,{text:e(c).content},null,8,["text"])])]),_:1}),i(h,{label:"问题讨论",name:"comment"},{default:w(()=>[i(p,{sid:e(c).id},null,8,["sid"])]),_:1})]),_:1},8,["modelValue"])])}}});const dt=ce(Be,[["__scopeId","data-v-bf64e19d"]]);export{dt as default};
